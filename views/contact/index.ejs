
<h2 class="mb-3">Contacts</h2>

<form class="row g-2 align-items-center mb-3" action="/contacts" method="get">
  <div class="col-auto">
    <input class="form-control" name="q" placeholder="Search name or email" value="<%= q || '' %>">
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-secondary" type="submit">Search</button>
  </div>
</form>

<table class="table table-striped align-middle">
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th style="width: 220px;">Actions</th>
    </tr>
  </thead>
  <tbody>
    <% if ((contacts||[]).length === 0) { %>
      <tr><td colspan="3" class="text-muted">No contacts found.</td></tr>
    <% } %>
    <% (contacts||[]).forEach(function(c){ %>
      <tr>
        <td><a href="/contacts/<%= c.id %>"><%= c.lastName %>, <%= c.firstName %></a></td>
        <td><%= c.email %></td>
        <td>
          <a class="btn btn-sm btn-outline-secondary" href="/contacts/<%= c.id %>">View</a>
          <a class="btn btn-sm btn-outline-primary" href="/contacts/<%= c.id %>/edit">Edit</a>
          <form class="d-inline" action="/contacts/<%= c.id %>/delete" method="post" onsubmit="return confirm('Delete this contact?');">
            <button class="btn btn-sm btn-outline-danger">Delete</button>
          </form>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<!-- Pagination -->
<nav aria-label="Page navigation">
  <ul class="pagination">
    <% const prev = page - 1; const next = page + 1; %>
    <li class="page-item <%= page <= 1 ? 'disabled' : '' %>">
      <a class="page-link" href="/contacts?page=<%= Math.max(prev,1) %>&limit=<%= limit %><%= q ? '&q=' + encodeURIComponent(q) : '' %>">Prev</a>
    </li>
    <% for (let p = 1; p <= pages; p++) { %>
      <li class="page-item <%= p === page ? 'active' : '' %>"><a class="page-link" href="/contacts?page=<%= p %>&limit=<%= limit %><%= q ? '&q=' + encodeURIComponent(q) : '' %>"><%= p %></a></li>
    <% } %>
    <li class="page-item <%= page >= pages ? 'disabled' : '' %>">
      <a class="page-link" href="/contacts?page=<%= Math.min(next,pages) %>&limit=<%= limit %><%= q ? '&q=' + encodeURIComponent(q) : '' %>">Next</a>
    </li>
  </ul>
</nav>
